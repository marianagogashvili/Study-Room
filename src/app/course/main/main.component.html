
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>

</head>
<body id="main">
	<div class="mainBody">
	<form *ngIf="newTopicMode && userType === 'teacher'" [formGroup]="topicForm" (ngSubmit)="createTopic()">
		<input 
			class="title__input" 
			type="text"
			name="title"
			required
			formControlName="title"
			>
		<div class="hidden__div">
			<label 
			class="hidden__label" 
			for="hide">hidden</label>
			<input 
				type="checkbox"
				class="hidden__input"
				id="hide"
				name="hide"
				formControlName="hidden">
		</div>
		<button 
			type="submit" 
			class="topic__btn"
			[disabled]="!topicForm.valid">Create Topic</button>	
		<button 
			type="button" 
			class="back__btn" (click)="topicMode()">Back</button>		
	</form>
	<button 
		*ngIf="!newTopicMode && userType === 'teacher'"
		type="submit" 
		class="new-topic__btn" (click)="topicMode()">New topic</button>	
	
	<!-- <div *ngIf="userType === 'teacher' || (userType === 'student' && topic.hidden === false)"></div> -->
	<div id="topicId" *ngFor="let topic of topics;  index as i">
		<form *ngIf="i === editIndex && userType === 'teacher'" [formGroup]="editForm" (ngSubmit)="editTopic(topic._id)">
			<input 
				class="title__input" 
				type="text"
				name="title"
				required
				formControlName="title"
				>
			<div class="hidden__div">
				<label 
				class="hidden__label" 
				for="hide">hidden</label>
				<input 
					type="checkbox"
					class="hidden__input"
					id="hide"
					name="hide"
					formControlName="hidden">
			</div>
			<button 
				type="submit" 
				class="topic__btn"
				[disabled]="!editForm.valid">Update</button>	
			<button 
				type="button" 
				class="back__btn" (click)="editIndex = null">Back</button>	
		</form>
		
		<div class="topic__div" >
			<div *ngIf="i !== editIndex ">
				<button 
				*ngIf="userType === 'teacher'"
				type="button" 
				class="add-before__btn" (click)="addBefore(topic)">add before</button>	

				<div class="topics__div" *ngIf="userType === 'teacher' || (userType === 'student' && topic.hidden === false)">
					
					<h1 [ngStyle]="topic.hidden === true && {'color':'grey'}" class="title__p" [id]="'topic'+i">{{ topic.title }}</h1>
					<p class="date__p">{{ topic.createdAt | date: 'd, MMM yyyy' }}</p>
					
					<div class="teacher__btns" *ngIf="userType === 'teacher'">
						<button class="edit__icon" (click)="showEditTopic(topic, i)">
						<fa-icon [icon]="editIcon"></fa-icon></button>
						<button class="delete__icon" (click)="removeTopic(topic._id, i)">
							<fa-icon [icon]="removeIcon"></fa-icon></button>

						<button 
							type="button" 
							class="add-assignment__btn" (click)="showAssignment(topic._id, null)">assignment</button>
						<button 
							type="button" 
							class="add-post__btn" (click)="showPost(topic._id)">post</button>
						<button 
							type="button" 
							class="add-test__btn" (click)="goToCreateTest(topic._id)">test</button>
						<button 
							type="button" 
							class="add-test__btn" (click)="showArticle(topic._id)">article</button>
						<button 
							type="button" 
							class="add-test__btn" (click)="showFolder(topic._id)">folder</button>
					</div>
					
				</div>
			</div>
			<div *ngIf="userType === 'teacher' || (userType === 'student' && topic.hidden === false)">
				<div class="assignments__div" *ngIf="topic.feed && topic.feed.length > 0; else elseBlock">
					<div class="row__div" *ngFor="let feedPost of topic.feed; index as postIndex">

						<!--------------- Post (file) ------------------->
						<span 
						*ngIf="(userType === 'teacher' || (userType === 'student' && feedPost.hidden === false)) && feedPost.fileUrl && !feedPost.maxGrade" 
						class="center__div"
						[ngStyle]="{'margin-left': feedPost.margin*16+'px'}">

							<!-- # File-icon -->
							<span class="pdf__icon" >
								<span 
									class="pdf__icon" 
									*ngIf="feedPost.fileUrl[feedPost.fileUrl.length - 1] === 'f'">
									<fa-icon [icon]="pdfIcon"></fa-icon>
								</span>
								<span 
									class="word__icon" 
									*ngIf="feedPost.fileUrl[feedPost.fileUrl.length - 2] ===  'c'">
									<fa-icon [icon]="wordIcon"></fa-icon>
								</span>
								<span
									class="powerpoint__icon" 
									*ngIf="feedPost.fileUrl[feedPost.fileUrl.length - 2] ===  'p'">
									<fa-icon [icon]="powerpointIcon"></fa-icon>
								</span>
							</span>

							<!-- # File-title -->
							<span 
								class="assignment__title" 
								(click)="openLink(feedPost.fileUrl, true)" 
								[ngClass]="{'hidden__span': feedPost.hidden}">
								{{ feedPost.title }}
							</span>

							<!-- # File-btns -->
							<span *ngIf="userType === 'teacher'" class="center__div">

								<!-- # File-move-btns -->
								<fa-icon 
									class="arrowleft__icon"
									[icon]="arrowLeftIcon" 
									(click)="move(feedPost._id, i, postIndex, -1, 'post')"></fa-icon>
								<fa-icon 
									class="arrowright__icon"
									[icon]="arrowRightIcon" 
									(click)="move(feedPost._id, i, postIndex, 1, 'post')"></fa-icon>

								<!-- # File-edit-btn -->
								<button 
									type="button" 
									class="edit-test__btn" (click)="goToEditPost(feedPost, topic._id, feedPost._id)">edit</button>

								<!-- # File-delete-btn -->
								<fa-icon 
									(click)="deletePopup = 'shown'; deletePopupIndex = postIndex"
									class="minus__icon" 
									[icon]="minusIcon">
								</fa-icon>

								<span 
									class="popupSpan" 
									*ngIf="deletePopupIndex === postIndex"  [@deletePopupHidden]="deletePopup" 
									[@deletePopup]="deletePopup">
									Are you sure ? 
									<button class="popupYesBtn" (click)="deletePost(i, postIndex, feedPost._id)">yes</button>
									<button class="popupNoBtn" (click)="deletePopup='hidden'">no</button>
								</span>
							</span>
							
						</span>

						
						<!--------------- Post (link) ------------------->

						<span 
							*ngIf="(userType === 'teacher' || (userType === 'student' && feedPost.hidden === false)) && feedPost.link" 
							class="center__div"
							[ngStyle]="{'margin-left': feedPost.margin*16+'px'}">

							<!-- # Link-icon -->
							<span class="link__icon" >
								<fa-icon [icon]="linkIcon"></fa-icon>
							</span>

							<!-- # Link-title -->
							<span 
								class="assignment__title link__icon__title" 
								(click)="openLink(feedPost.link, false)"
								[ngClass]="{'hidden__span': feedPost.hidden}">
								{{ feedPost.title }}</span>

							<!-- # Link-btns -->							
							<span 
								*ngIf="userType === 'teacher'" 
								class="center__div">

								<!-- # Link-move-btns -->
								<fa-icon 
									class="arrowleft__icon"
									[icon]="arrowLeftIcon" 
									(click)="move(feedPost._id, i, postIndex, -1, 'post')"></fa-icon>
								<fa-icon 
									class="arrowright__icon" 
									[icon]="arrowRightIcon" 
									(click)="move(feedPost._id, i, postIndex, 1, 'post')"></fa-icon>

								<!-- # Link-edit-btn -->
								<button 
									type="button" 
									class="edit-test__btn" (click)="goToEditPost(feedPost, topic._id, feedPost._id)">edit</button>

								<!-- # Link-delete-btn -->
								<fa-icon 
									class="minus__icon" 
									(click)="deletePopup = 'shown'; deletePopupIndex = postIndex"
									[icon]="minusIcon">
								</fa-icon>

								<span 
									class="popupSpan" 
									*ngIf="deletePopupIndex === postIndex"  [@deletePopupHidden]="deletePopup" 
									[@deletePopup]="deletePopup">
									Are you sure ? 
									<button class="popupYesBtn" (click)="deletePost(i, postIndex, feedPost._id)" >yes</button>
									<button class="popupNoBtn" (click)="deletePopup='hidden'">no</button>
								</span>
							</span>
							

						</span>

						<!--------------- Article ------------------->

						<span *ngIf="(userType === 'teacher' || (userType === 'student' && feedPost.hidden === false)) && feedPost.text" 
							class="center__div"
							[ngStyle]="{'margin-left': feedPost.margin*16+'px'}">

							<!-- # Article-icon -->
							<fa-icon 
								[icon]="articleIcon"
								class="article__icon"></fa-icon>

							<!-- # Article-title -->
							<span class="assignment__title link__icon__title" 
							[routerLink]="['../article', feedPost._id]" 
							[ngClass]="{'hidden__span': feedPost.hidden}">
								{{ feedPost.title }}</span>

							<!-- # Article-btns -->
							<span 
								*ngIf="userType === 'teacher'"
								class="center__div">

								<!-- # Article-move-btns -->
								<fa-icon 
									class="arrowleft__icon"
									[icon]="arrowLeftIcon" 
									(click)="move(feedPost._id, i, postIndex, -1, 'article')"></fa-icon>
								<fa-icon 
									class="arrowright__icon"
									[icon]="arrowRightIcon" 
									(click)="move(feedPost._id, i, postIndex, 1, 'article')"></fa-icon>

								<!-- # Article-edit-btn -->
								<!-- <button 
									type="button" 
									class="edit-test__btn" (click)="goToEditArticle(feedPost, topic._id, feedPost._id)">edit</button> -->
								<button 
									type="button" 
									class="edit-test__btn" (click)="goToEditArticle(feedPost, topic._id)">edit</button>

								<!-- # Article-delete-btn -->
								<fa-icon 
									(click)="deletePopup = 'shown'; deletePopupIndex = postIndex"
									class="minus__icon" 
									[icon]="minusIcon">
								</fa-icon>

								<span 
									class="popupSpan" 
									*ngIf="deletePopupIndex === postIndex"  [@deletePopupHidden]="deletePopup" 
									[@deletePopup]="deletePopup">
									Are you sure ? 
									<button class="popupYesBtn" (click)="deleteArticle(i, postIndex, feedPost._id)">yes</button>
									<button class="popupNoBtn" (click)="deletePopup='hidden'">no</button>
								</span>

							</span>
							
						</span>

						<!--------------- Assignment ------------------->

						<div 
							*ngIf="(userType === 'teacher' || (userType === 'student' && feedPost.hidden === false)) && feedPost.maxGrade" 
							class="center__div"
							[ngStyle]="{'margin-left': feedPost.margin*16+'px'}">

							<!-- # Assignment-icon -->
							<span class="file__icon">
								<!-- <fa-icon [icon]="fileIcon"></fa-icon> -->
								<fa-icon [icon]="downloadIcon"></fa-icon>

							</span>

							<!-- # Assignment-title -->
							<span class="assignment__title" [routerLink]="['../assignment/', feedPost._id]"  
							[ngClass]="{'hidden__span': feedPost.hidden}">
								{{ feedPost.title }}
							</span>

							<!-- # Assignment-btns -->
							<span 
								*ngIf="userType === 'teacher'"
								class="center__div">
								<fa-icon 
									class="arrowleft__icon"
									[icon]="arrowLeftIcon" 
									(click)="move(feedPost._id, i, postIndex, -1, 'assignment')"></fa-icon>
								<fa-icon 
									class="arrowright__icon"
									[icon]="arrowRightIcon" 
									(click)="move(feedPost._id, i, postIndex, 1, 'assignment')"></fa-icon>
							</span>
							
						</div>

						
						<!--------------- Testwork ------------------->

						<div 
							*ngIf="(userType === 'teacher' || (userType === 'student' && feedPost.hidden === false)) && feedPost.questions" 
							class="center__div"
							[ngStyle]="{'margin-left': feedPost.margin*16+'px'}">

							<!-- # Testwork-icon -->
							<span class="test__icon">
								<fa-icon [icon]="testIcon"></fa-icon>
							</span>

							<!-- # Testwork-title -->
							<span 
								(click)="goToTest(topic._id, feedPost._id)" 
								class="assignment__title"
							    [ngClass]="{'hidden__span': feedPost.hidden}">
							{{ feedPost.title }} </span>

							<!-- # Testwork-btns -->
							<span 
								*ngIf="userType === 'teacher'"
								class="center__div">

								<!-- # Testwork-move-btns -->
								<fa-icon 
									class="arrowleft__icon"
									[icon]="arrowLeftIcon" 
									(click)="move(feedPost._id, i, postIndex, -1, 'test')"></fa-icon>
								<fa-icon 
									class="arrowright__icon" 
									[icon]="arrowRightIcon" 
									(click)="move(feedPost._id, i, postIndex, 1, 'test')"></fa-icon>

								<!-- # Testwork-edit-btn -->
								<button 
									type="button" 
									class="edit-test__btn" (click)="goToEditTest(topic._id, feedPost._id)">edit</button>
							</span>
							
						</div>
						
					</div>
				</div>
			</div>
			
			<ng-template #elseBlock>
				<p class="nothing__p">No assignments yet</p>
			</ng-template>
		</div>
		
	</div>

	<div class="scroll__div">
		<button class="scroll__btn">
			<fa-icon (click)="goUp()" [icon]="upIcon"></fa-icon></button> 
		<button class="scroll__btn">
			<fa-icon (click)="goDown()" [icon]="downIcon"></fa-icon></button>
	</div>

	</div>

	<div class="sideNav">
		Topics
		<div *ngFor="let topic of topics; index as id" (click)="goToTopic(id)">
			{{ topic.title }}
		</div>
	</div>
</body>

</html>